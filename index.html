<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GTA-style OpenStreetMap (streets + POIs)</title>
  <meta name="description" content="Static GTA V–inspired map style over OpenStreetMap with streets and POIs, no backend required." />
  <link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    :root {
      /* GTA-inspired palette */
      --bg: #151515;
      --land: #1c1c1c;
      --water: #cfd3d6;
      --park: #242a24;
      --building: #2a2a2a;
      --road: #ffffff;
      --casing: #000000;
      --label: #e8e8e8;
      --label-halo: #000000;
      --poi-text: #f4eec3;     /* warm POI text */
      --poi-icon: #d6d09d;     /* warm POI icon */
      --ui: #0f0f0f;
      --ui-alt: #202020;
      --accent: #6ae1ff;
    }

    html, body { height: 100%; margin: 0; background: var(--bg); color: #ddd; }
    #map { position: absolute; inset: 0; }

    .panel {
      position: absolute;
      top: 12px;
      left: 12px;
      background: color-mix(in srgb, var(--ui) 85%, transparent);
      backdrop-filter: blur(6px);
      border: 1px solid #2b2b2b;
      border-radius: 10px;
      padding: 10px 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.45);
      max-width: 380px;
      font: 13px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
    }
    .panel h1 {
      margin: 0 0 6px;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.2px;
      color: #f0f0f0;
    }
    .panel .row { display: flex; gap: 8px; align-items: center; margin: 6px 0; }
    .panel .row.wrap { flex-wrap: wrap; }
    .panel label { white-space: nowrap; color: #cfcfcf; }
    .panel input[type="text"] {
      flex: 1;
      background: var(--ui-alt);
      border: 1px solid #3a3a3a;
      color: #ddd;
      border-radius: 8px;
      padding: 6px 8px;
      outline: none;
    }
    .panel input[type="checkbox"] {
      width: 16px; height: 16px; accent-color: #69d4ff;
    }
    .panel button, .panel a.btn {
      appearance: none;
      border: 1px solid #3a3a3a;
      background: var(--ui-alt);
      color: #ddd;
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex; align-items: center; gap: 6px;
    }
    .panel button:hover, .panel a.btn:hover { border-color: #4e4e4e; }
    .badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      background: #1e1e1e;
      border: 1px solid #333;
      color: #bbb;
      font-size: 11px;
    }
    .attribution {
      position: absolute; right: 8px; bottom: 8px;
      background: color-mix(in srgb, var(--ui) 85%, transparent);
      border: 1px solid #2b2b2b;
      border-radius: 8px; padding: 6px 8px; color: #bbb;
      font: 11px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
    }
    .attribution a { color: #a7e2ff; text-decoration: none; }
    .attribution a:hover { text-decoration: underline; }

    .hint {
      font-size: 11px; color: #9aa0a6;
      margin-top: 2px;
    }
  </style>
</head>
<body>
  <div id="map" aria-label="Map"></div>

  <div class="panel" role="region" aria-label="Map controls">
    <h1>GTA-style OSM <span class="badge">static</span></h1>

    <div class="row">
      <label>Provider:</label>
      <span id="provider" class="badge" title="Using public MapLibre demo tiles by default">Demo</span>
    </div>

    <div class="row">
      <label for="key" title="Optional: MapTiler key for global vector tiles">MapTiler key</label>
      <input id="key" type="text" placeholder="Optional — paste key and Apply" />
      <button id="apply">Apply</button>
    </div>
    <div class="row hint">Tip: You can also add ?key=YOUR_KEY to the URL.</div>

    <div class="row">
      <button id="toggleStyle" title="Toggle the GTA-inspired styling on/off">Toggle style</button>
      <a id="resetMel" class="btn" href="#" title="Jump to Melbourne">Melbourne</a>
      <a id="resetLS" class="btn" href="#" title="Jump to Los Santos–ish (LA)">Los Santos-ish</a>
    </div>

    <div class="row wrap">
      <label for="pois">POIs</label>
      <input id="pois" type="checkbox" checked />
      <label for="minorStreets">Minor streets</label>
      <input id="minorStreets" type="checkbox" checked />
      <label for="labels">Street labels</label>
      <input id="labels" type="checkbox" checked />
    </div>
  </div>

  <div class="attribution" role="contentinfo">
    © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>
    contributors | Map rendering with <a href="https://maplibre.org/">MapLibre GL JS</a>.
  </div>

  <script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
  <script>
    // Config/state
    const qs = new URLSearchParams(location.search);
    const initialKey = qs.get('key') || '';
    const state = {
      map: null,
      gtaOn: true,
      provider: initialKey ? 'maptiler' : 'demo', // 'demo' | 'maptiler'
      key: initialKey,
      poisOn: true,
      minorStreetsOn: true,
      labelsOn: true
    };

    // Views
    const mel = { center: [144.9631, -37.8136], zoom: 11.2 };
    const losSantosish = { center: [-118.2437, 34.0522], zoom: 11.2 };

    // UI elements
    const elKey = document.getElementById('key');
    const elProvider = document.getElementById('provider');
    const elApply = document.getElementById('apply');
    const elToggle = document.getElementById('toggleStyle');
    const elResetMel = document.getElementById('resetMel');
    const elResetLS = document.getElementById('resetLS');
    const elPois = document.getElementById('pois');
    const elMinor = document.getElementById('minorStreets');
    const elLabels = document.getElementById('labels');

    elKey.value = initialKey;

    function providerLabel() {
      elProvider.textContent = state.provider === 'maptiler' ? 'MapTiler' : 'Demo';
      elProvider.title = state.provider === 'maptiler'
        ? 'MapTiler vector tiles (key provided)'
        : 'Public MapLibre demo tiles (limited coverage)';
    }

    function getStyleURL() {
      if (state.provider === 'maptiler' && state.key) {
        // MapTiler Basic vector style (OpenMapTiles schema)
        return `https://api.maptiler.com/maps/basic/style.json?key=${state.key}`;
      }
      // MapLibre demo style (OpenMapTiles schema, limited coverage)
      return 'https://demotiles.maplibre.org/style.json';
    }

    function initMap(view = mel) {
      if (state.map) state.map.remove();

      const map = new maplibregl.Map({
        container: 'map',
        style: getStyleURL(),
        center: view.center,
        zoom: view.zoom,
        hash: true,
        attributionControl: true,
        dragRotate: false, pitchWithRotate: false
      });
      map.addControl(new maplibregl.NavigationControl({ showCompass: false }), 'top-right');

      map.on('style.load', () => {
        if (state.gtaOn) applyGTAStyle(map);
        setMinorStreets(map, state.minorStreetsOn);
        setStreetLabels(map, state.labelsOn);
        setPOIs(map, state.poisOn);
      });

      state.map = map;
    }

    // Styling helpers
    function getCSSVar(name, fallback) {
      return getComputedStyle(document.documentElement).getPropertyValue(name).trim() || fallback;
    }

    function applyGTAStyle(map) {
      const backgroundColor = getCSSVar('--bg', '#151515');
      const landColor       = getCSSVar('--land', '#1c1c1c');
      const waterColor      = getCSSVar('--water', '#cfd3d6');
      const parkColor       = getCSSVar('--park', '#242a24');
      const buildingColor   = getCSSVar('--building', '#2a2a2a');
      const roadColor       = getCSSVar('--road', '#ffffff');
      const casingColor     = getCSSVar('--casing', '#000000');
      const labelColor      = getCSSVar('--label', '#e8e8e8');
      const labelHalo       = getCSSVar('--label-halo', '#000000');

      const style = map.getStyle();
      if (!style || !style.layers) return;

      // Background
      style.layers.filter(l => l.type === 'background').forEach(l => {
        map.setPaintProperty(l.id, 'background-color', backgroundColor);
      });

      // Land tints
      style.layers.filter(l => l.type === 'fill' && /^(land|landcover|landuse)/.test(l['source-layer'] || l.id))
        .forEach(l => {
          map.setPaintProperty(l.id, 'fill-color', landColor);
          try { map.setPaintProperty(l.id, 'fill-opacity', 1.0); } catch {}
        });

      // Water
      style.layers.filter(l => (l.type === 'fill' || l.type === 'line') && /water/.test(l['source-layer'] || l.id))
        .forEach(l => {
          const prop = l.type === 'fill' ? 'fill-color' : 'line-color';
          map.setPaintProperty(l.id, prop, waterColor);
        });

      // Parks / vegetation
      style.layers.filter(l => l.type === 'fill' && /(park|wood|forest|grass|cemetery|pitch|meadow)/.test(l['source-layer'] || l.id))
        .forEach(l => {
          map.setPaintProperty(l.id, 'fill-color', parkColor);
        });

      // Buildings
      style.layers.filter(l => l.type === 'fill' && /building/.test(l['source-layer'] || l.id))
        .forEach(l => {
          map.setPaintProperty(l.id, 'fill-color', buildingColor);
          try { map.setPaintProperty(l.id, 'fill-outline-color', '#000000'); } catch {}
        });

      // Roads
      const roadLayers = style.layers.filter(l =>
        (l.type === 'line') && /(transportation|road|highway)/.test(l['source-layer'] || l.id)
      );
      const widthByClass = [
        'match', ['get', 'class'],
        'motorway', ['interpolate', ['exponential', 1.5], ['zoom'], 6, 0.8, 10, 2.6, 14, 7.0, 16, 13],
        'trunk',    ['interpolate', ['exponential', 1.5], ['zoom'], 6, 0.7, 10, 2.3, 14, 6.2, 16, 11.5],
        'primary',  ['interpolate', ['exponential', 1.5], ['zoom'], 6, 0.6, 10, 2.0, 14, 5.4, 16, 10],
        'secondary',['interpolate', ['exponential', 1.5], ['zoom'], 6, 0.5, 10, 1.8, 14, 4.6, 16, 9],
        'tertiary', ['interpolate', ['exponential', 1.5], ['zoom'], 6, 0.45,10, 1.6, 14, 4.0, 16, 8],
        'minor',    ['interpolate', ['exponential', 1.5], ['zoom'], 6, 0.4, 10, 1.4, 14, 3.4, 16, 7],
        'service',  ['interpolate', ['exponential', 1.5], ['zoom'], 6, 0.3, 10, 1.1, 14, 2.6, 16, 6],
        /* default */ ['interpolate', ['exponential', 1.5], ['zoom'], 6, 0.35, 10, 1.3, 14, 3.2, 16, 7]
      ];
      roadLayers.forEach(l => {
        map.setPaintProperty(l.id, 'line-color', roadColor);
        try { map.setPaintProperty(l.id, 'line-width', widthByClass); } catch {}
        try { map.setPaintProperty(l.id, 'line-opacity', 1); } catch {}
        try { map.setLayoutProperty(l.id, 'line-cap', 'round'); } catch {}
        try { map.setLayoutProperty(l.id, 'line-join', 'round'); } catch {}
      });

      // Road casings: adjust existing "casing" layers if present
      style.layers.filter(l => l.type === 'line' && /(casing|case)/i.test(l.id))
        .forEach(l => {
          map.setPaintProperty(l.id, 'line-color', casingColor);
          try {
            map.setPaintProperty(l.id, 'line-width', ['+', ['coalesce', map.getPaintProperty(l.id, 'line-width'), 2], 1.3]);
          } catch {
            map.setPaintProperty(l.id, 'line-width', ['interpolate', ['linear'], ['zoom'], 6, 1.0, 16, 15]);
          }
          try { map.setLayoutProperty(l.id, 'line-cap', 'round'); } catch {}
          try { map.setLayoutProperty(l.id, 'line-join', 'round'); } catch {}
        });

      // Boundaries toned down
      style.layers.filter(l => l.type === 'line' && /(boundary|admin)/i.test(l.id))
        .forEach(l => {
          map.setPaintProperty(l.id, 'line-color', '#404040');
          map.setPaintProperty(l.id, 'line-dasharray', [2, 2]);
          map.setPaintProperty(l.id, 'line-width', ['interpolate', ['linear'], ['zoom'], 4, 0.4, 12, 1]);
        });

      // Labels base: light text, dark halo; icons hidden by default (POI handler will re-enable)
      style.layers.filter(l => l.type === 'symbol')
        .forEach(l => {
          if (map.getLayoutProperty(l.id, 'text-field')) {
            try { map.setPaintProperty(l.id, 'text-color', labelColor); } catch {}
            try { map.setPaintProperty(l.id, 'text-halo-color', labelHalo); } catch {}
            try { map.setPaintProperty(l.id, 'text-halo-width', 1.0); } catch {}
            try { map.setPaintProperty(l.id, 'text-halo-blur', 0.2); } catch {}
          }
          try { map.setLayoutProperty(l.id, 'icon-size', 0.85); } catch {}
          try { map.setPaintProperty(l.id, 'icon-opacity', 0.0); } catch {}
          try { map.setLayoutProperty(l.id, 'symbol-sort-key', ['to-number', ['get', 'rank'], 9999]); } catch {}
        });
    }

    // Minor street visibility control (reduces clutter at low zooms if off)
    function setMinorStreets(map, show) {
      const style = map.getStyle();
      if (!style || !style.layers) return;
      const minorRegex = /(service|minor|path|track|pedestrian|footway|living_street)/i;

      style.layers
        .filter(l => l.type === 'line' && /(transportation|road|highway)/.test(l['source-layer'] || l.id))
        .forEach(l => {
          // If we can detect minor class, dim by zoom if toggled off
          try {
            map.setPaintProperty(l.id, 'line-opacity',
              show
                ? 1
                : ['case',
                    ['in', ['get', 'class'], ['literal', ['service','minor','path','track','pedestrian','footway','living_street']]],
                    ['interpolate', ['linear'], ['zoom'], 10, 0.0, 14, 0.25, 16, 0.5],
                    1
                  ]
            );
          } catch {
            // As a fallback, dim any "minor-ish" layers by id
            if (minorRegex.test(l.id)) {
              try { map.setPaintProperty(l.id, 'line-opacity', show ? 1 : ['interpolate', ['linear'], ['zoom'], 10, 0.0, 16, 0.4]); } catch {}
            }
          }
        });
    }

    // Street label hierarchy control
    function setStreetLabels(map, show) {
      const style = map.getStyle();
      if (!style || !style.layers) return;

      const isRoadNameLayer = (l) =>
        l.type === 'symbol' &&
        (/(transportation_name|road|highway)/.test(l.id) ||
         /(transportation_name|road|highway)/.test(l['source-layer'] || ''));

      style.layers.filter(isRoadNameLayer).forEach(l => {
        try {
          map.setPaintProperty(l.id, 'text-opacity',
            show
              ? ['interpolate', ['linear'], ['zoom'], 10, 0.0, 12, 0.7, 14, 1.0]
              : 0.0
          );
          // De-emphasize minor classes if available
          map.setPaintProperty(l.id, 'text-color',
            ['case',
              ['in', ['get', 'class'], ['literal', ['motorway','trunk','primary']]],
              getCSSVar('--label', '#e8e8e8'),
              '#bfbfbf'
            ]
          );
        } catch {}
      });
    }

    // POI control: show curated categories with warm icons/text, fade in by zoom
    function setPOIs(map, show) {
      const style = map.getStyle();
      if (!style || !style.layers) return;

      const poiTextColor = getCSSVar('--poi-text', '#f4eec3');
      const poiIconColor = getCSSVar('--poi-icon', '#d6d09d');

      const allowedPOIClasses = [
        'restaurant','cafe','fast_food','bar','pub',
        'fuel','bank','atm',
        'hospital','doctors','pharmacy',
        'school','college','university','library',
        'police','fire_station','post',
        'bus','tram','subway','train','parking',
        'park','playground','theatre','cinema','museum','attraction','beach','viewpoint',
        'toilets','supermarket','convenience','mall','marketplace',
        'hotel','motel','hostel','camp_site',
        'sports_centre','stadium','pitch','gym'
      ];

      const fadeByZoom = show
        ? ['interpolate', ['linear'], ['zoom'], 10, 0.0, 12, 0.5, 14, 1.0]
        : 0.0;

      const classGate = ['case',
        ['in', ['get', 'class'], ['literal', allowedPOIClasses]],
        1, // allowed
        0  // hidden
      ];

      // Adjust existing POI symbol layers if present
      const poiSymbolLayers = style.layers.filter(l =>
        l.type === 'symbol' &&
        (/poi/.test(l.id) || /poi/.test(l['source-layer'] || ''))
      );

      if (poiSymbolLayers.length) {
        poiSymbolLayers.forEach(l => {
          try { map.setPaintProperty(l.id, 'text-color', poiTextColor); } catch {}
          try { map.setPaintProperty(l.id, 'text-halo-color', '#000'); } catch {}
          try { map.setPaintProperty(l.id, 'text-halo-width', 1.2); } catch {}
          try { map.setPaintProperty(l.id, 'icon-color', poiIconColor); } catch {}
          try { map.setLayoutProperty(l.id, 'icon-size', 0.9); } catch {}
          try { map.setPaintProperty(l.id, 'icon-opacity', fadeByZoom); } catch {}
          try { map.setPaintProperty(l.id, 'text-opacity',
            ['*', fadeByZoom, classGate]
          ); } catch {}
        });
      } else {
        // If style has no POI symbol layer, try to add minimal POI layers (OpenMapTiles: source-layer "poi")
        const vectorSourceId = firstVectorSourceId(map);
        if (vectorSourceId) {
          try {
            if (!map.getLayer('gta-poi-circles')) {
              map.addLayer({
                id: 'gta-poi-circles',
                type: 'circle',
                source: vectorSourceId,
                'source-layer': 'poi',
                minzoom: 11,
                paint: {
                  'circle-radius': ['interpolate', ['linear'], ['zoom'], 11, 1.2, 16, 3.0],
                  'circle-color': poiIconColor,
                  'circle-opacity': ['*', fadeByZoom, classGate]
                },
                filter: ['in', ['get', 'class'], ['literal', allowedPOIClasses]]
              }, firstSymbolLayerId(map) || firstLabelLayerId(map));
            }
          } catch {}
          try {
            if (!map.getLayer('gta-poi-labels')) {
              map.addLayer({
                id: 'gta-poi-labels',
                type: 'symbol',
                source: vectorSourceId,
                'source-layer': 'poi',
                minzoom: 12,
                layout: {
                  'text-field': ['coalesce', ['get', 'name_en'], ['get', 'name']],
                  'text-size': ['interpolate', ['linear'], ['zoom'], 12, 10, 16, 13],
                  'text-font': ['Noto Sans Regular','Open Sans Regular']
                },
                paint: {
                  'text-color': poiTextColor,
                  'text-halo-color': '#000',
                  'text-halo-width': 1.2,
                  'text-opacity': ['*', fadeByZoom, classGate]
                },
                filter: ['in', ['get', 'class'], ['literal', allowedPOIClasses]]
              }, firstLabelLayerId(map));
            }
          } catch {}
        }
      }
    }

    // Utilities to find insertion anchors/sources
    function firstVectorSourceId(map) {
      const sources = map.getStyle().sources || {};
      for (const [id, src] of Object.entries(sources)) {
        if (src.type === 'vector') return id;
      }
      return null;
    }
    function firstLabelLayerId(map) {
      const layers = map.getStyle().layers || [];
      const label = layers.find(l => l.type === 'symbol' && map.getLayoutProperty(l.id, 'text-field'));
      return label ? label.id : null;
    }
    function firstSymbolLayerId(map) {
      const layers = map.getStyle().layers || [];
      const sym = layers.find(l => l.type === 'symbol');
      return sym ? sym.id : null;
    }

    // Reset to base provider style (removes our tweaks)
    function removeGTAStyle(map) {
      map.setStyle(getStyleURL());
    }

    // Wire UI
    elApply.addEventListener('click', () => {
      state.key = elKey.value.trim();
      state.provider = state.key ? 'maptiler' : 'demo';
      providerLabel();
      initMap(state.map ? { center: state.map.getCenter().toArray(), zoom: state.map.getZoom() } : mel);
    });

    elToggle.addEventListener('click', () => {
      state.gtaOn = !state.gtaOn;
      if (state.gtaOn) {
        applyGTAStyle(state.map);
        setMinorStreets(state.map, state.minorStreetsOn);
        setStreetLabels(state.map, state.labelsOn);
        setPOIs(state.map, state.poisOn);
      } else {
        removeGTAStyle(state.map);
      }
    });

    elResetMel.addEventListener('click', (e) => { e.preventDefault(); state.map?.flyTo({ center: mel.center, zoom: mel.zoom }); });
    elResetLS.addEventListener('click', (e) => { e.preventDefault(); state.map?.flyTo({ center: losSantosish.center, zoom: losSantosish.zoom }); });

    elPois.addEventListener('change', () => {
      state.poisOn = elPois.checked;
      setPOIs(state.map, state.poisOn);
    });
    elMinor.addEventListener('change', () => {
      state.minorStreetsOn = elMinor.checked;
      setMinorStreets(state.map, state.minorStreetsOn);
    });
    elLabels.addEventListener('change', () => {
      state.labelsOn = elLabels.checked;
      setStreetLabels(state.map, state.labelsOn);
    });

    // Init
    providerLabel();
    initMap(mel);
  </script>
</body>
</html>
